{% extends 'pokedex/base.html' %} 

{% block content %}
<div class="container mx-auto py-10 px-4">
  <!-- En-t√™te -->
  <div class="flex justify-between items-center mb-8">
    <h2 class="text-3xl font-bold text-slate-800">Mes √âquipes Pok√©mon</h2>
  </div>

  <!-- Liste des √©quipes existantes -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
    {% for team in teams %}
    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6">
      <h3 class="text-xl font-bold text-slate-700 mb-4">{{ team.name }}</h3>
      <div class="flex justify-between items-center bg-slate-50 rounded-xl p-3">
        {% for pokemon in team.pokemons.all %}
        <div class="flex flex-col items-center">
            <!-- On suppose que pokemon_detail a r√©cup√©r√© le sprite ou on utilise un placeholder. 
                 PokemonCapture n'a pas de champ sprite stock√©, mais l'ID permet de le retrouver 
                 via URL externe ou une m√©thode. Pour l'instant on affiche le nom.
                 Si on veut les images, il faudrait peut-√™tre enrichir les donn√©es dans la vue 
                 ou utiliser une URL directe pokeapi. -->
          <img 
            src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/{{ pokemon.pokemon_id }}.png" 
            alt="{{ pokemon.name }}" 
            class="w-12 h-12 object-contain"
          >
          <span class="text-xs text-slate-600 font-medium mt-1">{{ pokemon.name }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
    {% empty %}
    <div class="col-span-full bg-white rounded-3xl p-10 text-center shadow-inner border-2 border-dashed border-slate-300">
      <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
        üèÜ
      </div>
      <h3 class="text-xl font-semibold text-slate-600 mb-2">Aucune √©quipe form√©e</h3>
      <p class="text-slate-500 max-w-md mx-auto">
        Tu n'as pas encore d'√©quipe pr√™te au combat. Cr√©e ta premi√®re √©quipe ci-dessous !
      </p>
    </div>
    {% endfor %}
  </div>

  <!-- Formulaire de cr√©ation -->
  <div class="bg-white rounded-2xl shadow-xl overflow-hidden max-w-4xl mx-auto border border-slate-200">
    <div class="bg-slate-800 px-6 py-4 border-b border-slate-700">
      <h3 class="text-xl font-bold text-white flex items-center gap-2">
        <span>‚öîÔ∏è</span> Cr√©er une nouvelle √©quipe
      </h3>
    </div>
    
    <form method="post" class="p-8">
      {% csrf_token %}
      
      <!-- Erreurs globales -->
      {% if form.non_field_errors %}
      <div class="mb-6 bg-red-50 border-l-4 border-red-500 p-4 text-red-700">
        {{ form.non_field_errors }}
      </div>
      {% endif %}

      <!-- Nom de l'√©quipe -->
      <div class="mb-8">
        <label class="block text-slate-700 font-semibold mb-2" for="{{ form.name.id_for_label }}">
          Nom de l'√©quipe
        </label>
        {{ form.name }}
        {% if form.name.errors %}
        <p class="text-red-500 text-sm mt-1">{{ form.name.errors.0 }}</p>
        {% endif %}
      </div>

      <!-- S√©lection des Pok√©mons -->
      <div class="mb-8">
        <label class="block text-slate-700 font-semibold mb-4">
          S√©lectionnez exactement 5 Pok√©mons :
        </label>
        
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 max-h-96 overflow-y-auto p-2 bg-slate-50 rounded-xl border border-slate-200">
          {% for checkbox in form.pokemons %}
          <div class="relative group">
            <label class="cursor-pointer block h-full">
              <!-- Le checkbox cach√© mais fonctionnel -->
              {{ checkbox.tag }} 
              
              <!-- Carte visuelle -->
              <div class="border-2 border-slate-200 rounded-xl p-3 bg-white hover:border-blue-400 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition-all h-full flex flex-col items-center text-center">
                 <!-- On essaie d'extraire l'ID du Pok√©mon depuis le label ou l'objet choice 
                      Mais checkbox.choice_label est juste le __str__. 
                      Pour avoir l'image, c'est plus dur sans custom widget. 
                      On va faire simple pour l'instant : juste le label. -->
                 <span class="text-sm font-medium text-slate-700">{{ checkbox.choice_label }}</span>
              </div>
            </label>
          </div>
          {% endfor %}
        </div>
        {% if form.pokemons.errors %}
        <div class="mt-2 text-red-500 font-semibold text-center">
            {{ form.pokemons.errors.0 }}
        </div>
        {% endif %}
      </div>

      <!-- Bouton soumission -->
      <div class="text-center">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transition transform hover:scale-105">
          Valider l'√©quipe
        </button>
      </div>
    </form>
  </div>
</div>

<style>
/* Style custom pour les checkboxes si besoin */
input[type="checkbox"]:checked + div {
    border-color: #2563eb;
    background-color: #eff6ff;
}
</style>
{% endblock %}
