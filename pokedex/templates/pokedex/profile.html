{% extends 'pokedex/base.html' %} {% block content %}
<div class="container mx-auto px-4 py-8">
  <div
    class="bg-white rounded-3xl shadow-xl p-8 mb-10 border-l-8 border-red-600 flex flex-col md:flex-row items-center gap-6"
  >
    <div
      class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center text-3xl font-bold text-white shadow-lg"
    >
      {{ user.username|slice:":1"|upper }}
    </div>

    <div class="flex items-center gap-3 justify-center md:justify-start">
    
        <div class="flex flex-col">
            <h1 class="text-3xl font-extrabold text-slate-800">
                {% if user.first_name %}
                 {{ user.first_name }} {{ user.last_name }}
                {% else %}
                     {{ user.username }}
                {% endif %}
            </h1>
            
            {% if user.first_name %}
                <span class="text-sm text-gray-400 font-bold">@{{ user.username }}</span>
            {% endif %}
        </div>

        <a href="{% url 'edit_profile' %}" class="bg-slate-100 hover:bg-slate-200 text-slate-600 p-2 rounded-full transition h-10 w-10 flex items-center justify-center" title="Modifier le profil">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
        </a>
    </div>
      <div class="mt-4 md:mt-0 md:ml-auto text-center md:text-left">
      <p class="text-slate-500 font-bold mt-1">
        Pok√©dex :
        <span class="text-red-600 text-xl">{{ captures|length }}</span> Pok√©mons
        captur√©s
      </p>
      </div>
    </div>
  </div>

  <h2
    class="text-2xl font-bold text-white mb-6 bg-slate-800 inline-block px-6 py-2 rounded-full shadow-lg border-2 border-slate-600"
  >
    Pok√©mons captur√©s
  </h2>

  {% if captures %}
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
    {% for pokemon in captures %}
    <div
      class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-2 overflow-hidden border-2 border-slate-100 relative group"
    >
      <div
        class="absolute top-2 right-2 bg-slate-800 text-white text-xs font-bold px-2 py-1 rounded-full z-10 shadow-sm"
      >
        Niv. {{ pokemon.level }}
      </div>
      <a href="{% url 'capture_detail' pokemon.id %}">
      <div
        class="bg-slate-50 p-4 flex justify-center items-center h-32 relative"
      >
        <div
          class="absolute w-20 h-20 bg-white rounded-full opacity-50 blur-xl"
        ></div>

        <img
          src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/{{ pokemon.pokemon_id }}.png"
          alt="{{ pokemon.name }}"
          class="w-24 h-24 object-contain drop-shadow-md group-hover:scale-110 transition duration-300 z-10"
        />
      </div>

      <div class="p-4 text-center bg-white">
        <p class="text-[10px] text-gray-400 font-bold tracking-widest mb-1">
          #{{ pokemon.pokemon_id }}
        </p>

        <h3
          class="text-lg font-extrabold text-slate-800 capitalize leading-tight truncate"
        >
          {{ pokemon.name }}
        </h3>

        <p class="text-[10px] text-gray-400 mt-2">
          Captur√© le {{ pokemon.captured_at|date:"d/m/Y" }}
        </p>
      </div>
      </a>
      <div class="mt-4 pt-3 border-t border-slate-100">
        <button
          type="button"
          onclick="openModal('{% url 'release_pokemon' pokemon.id %}', '{{ pokemon.nickname|default:pokemon.name|escapejs }}')"
          class="w-full text-center text-xs font-bold text-red-400 hover:text-red-600 hover:bg-red-50 py-2 rounded transition uppercase tracking-wider flex items-center justify-center gap-1"
        >
          <svg
            class="w-3 h-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
            ></path>
          </svg>
          Rel√¢cher
        </button>
      </div>
    </div>
    {% endfor %}
  </div>

  {% else %}
  <div
    class="flex flex-col items-center justify-center py-20 bg-white/10 rounded-3xl backdrop-blur-sm border-2 border-dashed border-white/30 text-center"
  >
    <div class="text-6xl mb-4">üï∏Ô∏è</div>
    <p class="text-white text-xl font-bold mb-4">Ton PC est vide !</p>
    <p class="text-red-100 mb-6 max-w-md">
      Tu n'as pas encore captur√© de Pok√©mon. Va explorer le monde pour commencer
      ta collection.
    </p>
    <a
      href="{% url 'index' %}"
      class="bg-yellow-400 hover:bg-yellow-500 text-red-900 px-8 py-3 rounded-full font-bold shadow-lg transition transform hover:scale-105 border-b-4 border-yellow-600"
    >
      Partir chasser des Pok√©mons
    </a>
  </div>
  {% endif %}
</div>
<!-- Modale de confirmation de relachement du pok√©mon -->
<div
  id="releaseModal"
  class="fixed inset-0 z-50 hidden overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity backdrop-blur-sm"
      aria-hidden="true"
      onclick="closeModal()"
    ></div>

    <span
      class="hidden sm:inline-block sm:align-middle sm:h-screen"
      aria-hidden="true"
      >&#8203;</span
    >

    <div
      class="relative inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full border-t-8 border-red-500"
    >
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div
            class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
          >
            <svg
              class="h-6 w-6 text-red-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              />
            </svg>
          </div>

          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
            <h3
              class="text-lg leading-6 font-bold text-slate-900"
              id="modal-title"
            >
              Rel√¢cher le Pok√©mon ?
            </h3>
            <div class="mt-2">
              <p class="text-sm text-slate-500">
                Es-tu certain de vouloir te s√©parer de
                <span id="pokemonNameSpan" class="font-bold text-slate-800"
                  >ce Pok√©mon</span
                >
                ? <br />Cette action est irr√©versible, il retournera √† la vie
                sauvage.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div
        class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-2"
      >
        <a
          id="confirmDeleteBtn"
          href="#"
          class="w-full inline-flex justify-center rounded-xl border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-bold text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm transition"
        >
          Oui, au revoir !
        </a>

        <button
          type="button"
          onclick="closeModal()"
          class="mt-3 w-full inline-flex justify-center rounded-xl border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-bold text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition"
        >
          Annuler
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function openModal(deleteUrl, pokemonName) {
    document.getElementById("pokemonNameSpan").innerText = pokemonName;
    document.getElementById("confirmDeleteBtn").href = deleteUrl;
    document.getElementById("releaseModal").classList.remove("hidden");
  }

  function closeModal() {
    document.getElementById("releaseModal").classList.add("hidden");
  }
</script>
{% endblock %}
